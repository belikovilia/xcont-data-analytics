<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Анализатор PDF: группы С5 и С10</title>
    <link rel="stylesheet" href="./styles/styles.css" />
    <!-- PDF.js (без воркера, отключим в app.js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js" crossorigin="anonymous"></script>
    <!-- jsPDF для генерации PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>
    <!-- Наш модуль PDF -->
    <script src="./js/pdf.js"></script>
    <!-- Иконочный шрифт (Material Symbols) -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
  </head>
  <body>
    <main class="container">
      <section class="card">
        <h1>Анализатор отчетов пиццерии</h1>
        <p class="muted">Загрузите PDF-отчет или текст для автоматического формирования топа нарушений.</p>

        <div class="mode-switch" role="tablist" aria-label="Способ ввода">
          <button id="modePdfBtn" class="seg active" role="tab" aria-selected="true">PDF</button>
          <button id="modeTextBtn" class="seg" role="tab" aria-selected="false">Текст</button>
        </div>

        <div id="inputPdf" class="input-mode">
          <div class="uploader">
            <label for="pdfInput" class="button">Загрузить PDF</label>
            <input id="pdfInput" type="file" accept="application/pdf" />
            <span id="fileName" class="file-name">Файл не выбран</span>
          </div>
        </div>

        <div id="inputText" class="input-mode hidden">
          <textarea id="textAreaInput" class="text-area" rows="8" placeholder="Вставьте текст для анализа…"></textarea>
          <div style="margin-top:10px; display:flex; gap:10px; align-items:center;">
            <button id="analyzeTextBtn" class="button" type="button">Анализировать текст</button>
            <span class="muted" style="font-size:12px;">Вставьте содержимое отчёта. Форматирование строк сохраняется.</span>
          </div>
        </div>

        <div class="control-row">
          <label id="labelToggleGroupDetails" class="dev-only hidden">
            <input id="toggleGroupDetails" type="checkbox" /> Показывать строки внутри категорий
          </label>
          <label id="labelToggleDebug" class="dev-only hidden">
            <input id="toggleDebug" type="checkbox" /> Режим отладки (логи в консоли)
          </label>
        </div>

        <div class="controls">
          <div class="control">
            <label for="topSelect">Выбор ТОП</label>
            <select id="topSelect" class="select">
              <option value="3">ТОП-3</option>
              <option value="5">ТОП-5</option>
              <option value="10">ТОП-10</option>
            </select>
            <div id="errTop" class="error-text hidden"></div>
          </div>

          <div class="control">
            <label for="storeSelect">Пиццерия</label>
            <input id="storeSearch" class="input" type="text" placeholder="Поиск…" />
            <select id="storeSelect" class="select">
              <option value="">— выбрать —</option>
            </select>
            <div id="errStore" class="error-text hidden"></div>
          </div>

          <div class="control">
            <label for="periodSelect">Период</label>
            <select id="periodSelect" class="select">
              <option value="">— выбрать —</option>
            </select>
            <div id="errPeriod" class="error-text hidden"></div>
          </div>

          <div class="btns-row">
            <button id="previewPdfBtn" class="button" type="button"><span class="icon">visibility</span>Предпросмотр</button>
            <button id="downloadPdfBtn" class="button ghost" type="button"><span class="icon">download</span>Скачать</button>
          </div>
        </div>

        <div id="rulesBanner" class="rules-banner hidden">
          <div class="rules-banner-title">База категорий не загружена</div>
          <div class="rules-banner-desc">Положите файлы правил рядом со страницей: <code>rules_c5.txt</code> и <code>rules_c10.txt</code>, или загрузите ниже вручную.</div>
          <div class="rules-actions">
            <label class="button ghost">Загрузить C5
              <input id="rulesC5File" type="file" accept=".txt" />
            </label>
            <label class="button ghost">Загрузить C10
              <input id="rulesC10File" type="file" accept=".txt" />
            </label>
            <span id="rulesStatus" class="file-name">C5: —, C10: —</span>
          </div>
        </div>

        <div id="status" class="status"></div>
      </section>

      <section id="results" class="results hidden">
        <div class="summary">
          <div><strong>Страниц:</strong> <span id="pagesCount">–</span></div>
          <div><strong>Совпадений С5:</strong> <span id="c5Count">0</span></div>
          <div><strong>Совпадений С10:</strong> <span id="c10Count">0</span></div>
        </div>

        <details open>
          <summary>Категории С5 (<span id="c5GroupedTotal">0</span>)</summary>
          <ol id="groupC5List" class="result-list"></ol>
        </details>

        <details>
          <summary>Категории С10 (<span id="c10GroupedTotal">0</span>)</summary>
          <ol id="groupC10List" class="result-list"></ol>
        </details>

        <details id="devUngroupedC5" class="hidden">
          <summary>Без категории С5</summary>
          <ol id="ungroupedC5" class="result-list"></ol>
        </details>

        <details id="devUngroupedC10" class="hidden">
          <summary>Без категории С10</summary>
          <ol id="ungroupedC10" class="result-list"></ol>
        </details>

        <details id="devListC5" class="hidden">
          <summary>Строки с С5 (<span id="c5CountInline">0</span>)</summary>
          <ol id="listC5" class="result-list"></ol>
        </details>

        <details id="devListC10" class="hidden">
          <summary>Строки с С10 (<span id="c10CountInline">0</span>)</summary>
          <ol id="listC10" class="result-list"></ol>
        </details>
      </section>
    </main>

    <!-- Прелоадер поверх страницы -->
    <div id="preloader" class="preloader hidden" aria-live="polite" aria-busy="true">
      <div class="loader-card">
        <div class="spinner" aria-hidden="true"></div>
        <div id="loaderText" class="loader-text">Подготовка…</div>
      </div>
    </div>

    <script src="./js/app.js"></script>
    <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>
  </body>
  </html>